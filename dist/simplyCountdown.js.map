{"version":3,"file":"simplyCountdown.js","sources":["../src/core/dom.ts","../src/core/simplyCountdown.ts"],"sourcesContent":["/**\n * Creates a countdown section element\n */\nexport const createCountdownSection = (\n    sectionClass: string,\n    amount: number,\n    word: string\n): HTMLElement => {\n    const section = document.createElement('div');\n    section.className = `simply-section ${sectionClass}`;\n\n    const wrap = document.createElement('div');\n    const amount_elem = document.createElement('span');\n    const word_elem = document.createElement('span');\n\n    amount_elem.className = 'simply-amount';\n    word_elem.className = 'simply-word';\n\n    amount_elem.textContent = String(amount);\n    word_elem.textContent = word;\n\n    wrap.appendChild(amount_elem);\n    wrap.appendChild(word_elem);\n    section.appendChild(wrap);\n\n    return section;\n};\n\n/**\n * Retrieves a countdown section element from a container\n */\nexport const getCountdownSection = (\n    sectionClass: string,\n    container: HTMLElement\n): HTMLElement | null => {\n    return container.querySelector(`.simply-section.${sectionClass}`);\n};\n\n/**\n * Updates a countdown section element\n */\nexport const updateCountdownSection = (\n    section: HTMLElement,\n    amount: number | string,\n    word: string\n): void => {\n    const amountElement = section.querySelector('.simply-amount');\n    const wordElement = section.querySelector('.simply-word');\n\n    if (amountElement) {\n        amountElement.textContent = String(amount);\n    }\n    if (wordElement) {\n        wordElement.textContent = word;\n    }\n};\n\n/**\n * Creates all countdown elements\n */\nexport const createCountdown = (\n    container: HTMLElement\n): {\n    days: HTMLElement;\n    hours: HTMLElement;\n    minutes: HTMLElement;\n    seconds: HTMLElement;\n} => {\n    const days = createCountdownSection('simply-days-section', 0, 'day');\n    const hours = createCountdownSection('simply-hours-section', 0, 'hour');\n    const minutes = createCountdownSection('simply-minutes-section', 0, 'minute');\n    const seconds = createCountdownSection('simply-seconds-section', 0, 'second');\n\n    container.appendChild(days);\n    container.appendChild(hours);\n    container.appendChild(minutes);\n    container.appendChild(seconds);\n\n    return {\n        days,\n        hours,\n        minutes,\n        seconds\n    };\n};\n","/*!\n * Project : simplyCountdown\n * Date : 2024-12-24\n * License : MIT\n * Version : 3.0.0\n * Author : Vincent Loy-Serre <vincent.loy1@gmail.com>\n * Contributors :\n *  - Justin Beasley <JustinB@harvest.org>\n *  - Nathan Smith <NathanS@harvest.org>\n */\n\nimport type { CountdownParameters, CountdownSelector } from '../types';\nimport { createCountdown, updateCountdownSection } from './dom';\n\nconst defaultParams: CountdownParameters = {\n    year: 2024,\n    month: 12,\n    day: 25,\n    hours: 0,\n    minutes: 0,\n    seconds: 0,\n    words: {\n        days: { lambda: (root, n) => n > 1 ? root + 's' : root, root: 'day' },\n        hours: { lambda: (root, n) => n > 1 ? root + 's' : root, root: 'hour' },\n        minutes: { lambda: (root, n) => n > 1 ? root + 's' : root, root: 'minute' },\n        seconds: { lambda: (root, n) => n > 1 ? root + 's' : root, root: 'second' }\n    },\n    plural: true,\n    inline: false,\n    inlineSeparator: ', ',\n    enableUtc: false,\n    onEnd: () => {},\n    refresh: 1000,\n    inlineClass: 'simply-countdown-inline',\n    sectionClass: 'simply-section',\n    amountClass: 'simply-amount',\n    wordClass: 'simply-word',\n    zeroPad: false,\n    countUp: false,\n    removeZeroUnits: false\n};\n\nconst isNodeList = (element: CountdownSelector): element is NodeListOf<HTMLElement> => {\n    return element instanceof NodeList;\n};\n\ninterface TimeUnit {\n    value: number;\n    word: keyof CountdownParameters['words'];\n    element?: HTMLElement;\n}\n\n/**\n * Formats a time unit with optional zero padding and pluralization\n * @param unit - The time unit object containing value and word properties\n * @param params - The countdown parameters containing formatting options and word definitions\n * @returns A formatted string containing the value and pluralized word for the time unit\n * @example\n * // With zeroPad: true\n * formatTimeUnit({value: 5, word: 'days'}, params) // returns \"05 days\"\n * // With zeroPad: false\n * formatTimeUnit({value: 5, word: 'days'}, params) // returns \"5 days\"\n */\nfunction formatTimeUnit(unit: TimeUnit, params: CountdownParameters): string {\n    const value = params.zeroPad ? String(unit.value).padStart(2, '0') : unit.value;\n    return `${value} ${params.words[unit.word].lambda(params.words[unit.word].root, unit.value)}`;\n}\n\n/**\n * Determines whether a time unit should be displayed based on its value and the values of previous units\n * @param unit - The current time unit to evaluate\n * @param previousUnits - Array of time units that come before the current unit\n * @param params - Configuration parameters for the countdown\n * @returns True if the unit should be displayed, false otherwise\n * \n * If removeZeroUnits is false in params, always returns true.\n * Otherwise, returns true if either:\n * - The current unit value is not zero\n * - Any previous unit has a non-zero value\n */\nfunction shouldDisplay(unit: TimeUnit, previousUnits: TimeUnit[], params: CountdownParameters): boolean {\n    if (!params.removeZeroUnits) return true;\n    return unit.value !== 0 || previousUnits.some(u => u.value !== 0);\n}\n\n/**\n * Displays the countdown timer inline within the specified HTML element.\n * \n * @param timeUnits - Array of time units containing values and labels for display\n * @param params - Configuration parameters for the countdown display\n * @param element - The HTML element where the countdown will be rendered\n * \n * @remarks\n * The function filters and formats time units based on display rules, then joins them with\n * the specified separator from params.inlineSeparator before setting the element's innerHTML.\n */\nfunction displayInline(timeUnits: TimeUnit[], params: CountdownParameters, element: HTMLElement): void {\n    const displayStr = timeUnits\n        .filter((unit, index) => shouldDisplay(unit, timeUnits.slice(0, index), params))\n        .map(unit => formatTimeUnit(unit as { value: number; word: keyof typeof params.words }, params))\n        .join(params.inlineSeparator);\n\n    element.innerHTML = displayStr;\n}\n\n/**\n * Updates the display of time units in the countdown based on their values and display conditions\n * @param timeUnits - Array of TimeUnit objects containing the time values and their corresponding words\n * @param params - Configuration parameters for the countdown display\n * @param countdown - DOM elements representing the countdown display sections\n * @returns void\n *\n * @remarks\n * This function iterates through each time unit and determines whether it should be shown based on:\n * - If it's the seconds unit (always shown)\n * - If it meets display criteria based on previous units\n * \n * For units that should be shown, it:\n * - Updates the display value (with optional zero padding)\n * - Updates the word label using the configured lambda function\n * - Shows the unit's DOM element\n * \n * For units that shouldn't be shown, it hides their DOM elements\n */\nfunction displayBlocks(timeUnits: TimeUnit[], params: CountdownParameters, countdown: any): void {\n    timeUnits.forEach((unit, index) => {\n        const shouldShow = unit.word === 'seconds' || shouldDisplay(unit, timeUnits.slice(0, index), params);\n        \n        if (shouldShow) {\n            updateCountdownSection(\n                countdown[unit.word],\n                params.zeroPad ? String(unit.value).padStart(2, '0') : unit.value,\n                params.words[unit.word].lambda(params.words[unit.word].root, unit.value)\n            );\n            countdown[unit.word].style.display = '';\n        } else {\n            countdown[unit.word].style.display = 'none';\n        }\n    });\n}\n\nconst createCountdownInstance = (targetElement: HTMLElement, parameters: CountdownParameters) => {\n    const targetDate = new Date(\n        parameters.year,\n        parameters.month - 1,\n        parameters.day,\n        parameters.hours,\n        parameters.minutes,\n        parameters.seconds\n    );\n\n    // Create span element for inline mode\n    let inlineElement: HTMLElement | null = null;\n    if (parameters.inline) {\n        inlineElement = document.createElement('span');\n        inlineElement.className = parameters.inlineClass;\n        targetElement.appendChild(inlineElement);\n    }\n\n    const countdown = parameters.inline ? null : createCountdown(targetElement);\n\n    const refresh = () => {\n        const currentDate = parameters.enableUtc ? new Date(new Date().toUTCString()) : new Date();\n        let diff = parameters.countUp\n            ? currentDate.getTime() - targetDate.getTime()\n            : targetDate.getTime() - currentDate.getTime();\n\n        if (diff <= 0 && !parameters.countUp) {\n            diff = 0;\n            if (parameters.onEnd) {\n                parameters.onEnd();\n            }\n        }\n\n        const days = Math.floor(diff / (1000 * 60 * 60 * 24));\n        diff -= days * 1000 * 60 * 60 * 24;\n\n        const hours = Math.floor(diff / (1000 * 60 * 60));\n        diff -= hours * 1000 * 60 * 60;\n\n        const minutes = Math.floor(diff / (1000 * 60));\n        diff -= minutes * 1000 * 60;\n\n        const seconds = Math.floor(diff / 1000);\n\n        if (parameters.inline && inlineElement) {\n            const timeUnits: TimeUnit[] = [\n                { value: days, word: 'days' as keyof CountdownParameters['words'] },\n                { value: hours, word: 'hours' as keyof CountdownParameters['words'] },\n                { value: minutes, word: 'minutes' as keyof CountdownParameters['words'] },\n                { value: seconds, word: 'seconds' as keyof CountdownParameters['words'] }\n            ];\n            displayInline(timeUnits, parameters, inlineElement);\n        } else if (countdown) {\n            const timeUnits: TimeUnit[] = [\n                { value: days, word: 'days' as keyof CountdownParameters['words'] },\n                { value: hours, word: 'hours' as keyof CountdownParameters['words'] },\n                { value: minutes, word: 'minutes' as keyof CountdownParameters['words'] },\n                { value: seconds, word: 'seconds' as keyof CountdownParameters['words'] }\n            ];\n            displayBlocks(timeUnits, parameters, countdown);\n        }\n    };\n\n    const interval = setInterval(refresh, parameters.refresh);\n    refresh();\n\n    // Cleanup on element removal\n    const observer = new MutationObserver((mutations) => {\n        mutations.forEach((mutation) => {\n            mutation.removedNodes.forEach((node) => {\n                if (node === targetElement) {\n                    clearInterval(interval);\n                    observer.disconnect();\n                }\n            });\n        });\n    });\n\n    if (targetElement.parentNode) {\n        observer.observe(targetElement.parentNode, { childList: true });\n    }\n};\n\nexport default (\n    element: CountdownSelector,\n    args: Partial<CountdownParameters> = defaultParams\n): void => {\n    const parameters: CountdownParameters = { ...defaultParams, ...args };\n\n    if (typeof element === 'string') {\n        const elements = document.querySelectorAll<HTMLElement>(element);\n        elements.forEach((el) => createCountdownInstance(el, parameters));\n    } else if (isNodeList(element)) {\n        element.forEach((el) => createCountdownInstance(el, parameters));\n    } else {\n        createCountdownInstance(element, parameters);\n    }\n};"],"names":[],"mappings":"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"}